	SUBROUTINE resccal(NRES,CHNM,KT1,KT2)
	CHARACTER*150 ENPDB
	CHARACTER*62 HEADP
	CHARACTER*50 FNAME
	CHARACTER*14 FNGFPDB1,FNGFPDB2
	CHARACTER*4 ENPDB1
	CHARACTER*1  NAMCH(29000), NACH, NAMCHC,NNMCH,AA,NNMCHCC
	CHARACTER*6 DEF
	CHARACTER*3 NAMR(29000),NAMRC,LISTCOF(200),NNMAR,NMR
     2	,NAM3(20),NMF3,NAM3CC
	CHARACTER*2 DC1
	CHARACTER*10 DC2
	CHARACTER*1 ALET(10),CHNM
     2	,CMET(29000),CA1(29000),CA2(29000),CA3(29000),A1F
     3	,READI,LISTCH(200),ALET1(13)
	CHARACTER*1 NCHINSQ(4000),NMF1,NCHCOF(200)
	CHARACTER*1 LNMC1(200,30), LNMC2(200,30), LNMC3(200,30)
	CHARACTER*1 LNMO1(200,30), LNMO2(200,30), LNMO3(200,30)
	CHARACTER*1 LNMN1(200,30), LNMN2(200,30), LNMN3(200,30)
	INTEGER*4 SVT(36),
     2	NFAR(20)
     3	,LBCH(200),NCOFR(200),NCOFACT
     4	,HBCH(200),NCOFIJR(200),HBCOF(200)
	INTEGER*2 COD(29000),SVA(29000),SVAR(167)
	COMMON /CALET/ ALET,ALET1
	COMMON /CNAM/ NAM3
	COMMON /CSVAR/ SVAR
	COMMON /CANCOF/	NACCOF(200),NAOCOF(200),NANCOF(200)
	COMMON /CNFAR/	NFAR
	COMMON /CLNB/	LNBC(200,30),LNBO(200,30),LNBN(200,30)
	COMMON /CLNMC/ LNMC1,LNMC2,LNMC3
	COMMON /CLNMO/ LNMO1,LNMO2,LNMO3
	COMMON /CLNMN/ LNMN1,LNMN2,LNMN3
	COMMON /CNACOF/	LBCOF(200),HBCOF
	COMMON /CXYZ/	X(29000),Y(29000),Z(29000)
	COMMON /CENPDB/	ENPDB1
	COMMON /CNCOFACT/ NNNCOF
	COMMON /CNMF1/	NMF1
	COMMON /CUNUS/ IAPROT,IAUNUS
	COMMON /CNRF/	NRF
	COMMON /CNMF3/	NMF3
	COMMON /CIJR/	IJR
	COMMON /NMC/	NACH, NAMR, NAMCH
	COMMON /NOC/	NOR1, NOR(29000)
	COMMON /SVC/	SVA
	COMMON /CSVT/	SVT
	COMMON /CRA/	RA(13), SN, ZN, SZP, SAP
	COMMON /NABEC/ 	NAB(4000),NAE(4000),NRINSQ(4000)
	COMMON /CXCR/	XCR(4000), YCR(4000), ZCR(4000), RDR(4000)
	COMMON /CCCOD/	COD
	COMMON /CNTYP/	NTYP
	COMMON /CNN1/	NA
	COMMON /COMCC/	CMET, CA1, CA2, CA3
     	COMMON /UACC/ 	XUACC(1000), YUACC(1000), ZUACC(1000)
	IF (KT2.GT.0) GOTO 1
	PRINT 4883,NRES,CHNM
 4883	FORMAT ('There is NO residue number', I5
     k,' in chain ',A1)
	goto 2
    1	CONTINUE
	CALL WIF083 (XUACC,YUACC,ZUACC)
	CALL RESCONH(KT1,KT2)
  890	CONTINUE
  891	CONTINUE
    2	RETURN
	END
	SUBROUTINE RESCONH(KT1,KT2)
	CHARACTER*1  CMET(29000), CA1(29000), CA2(29000), CA3(29000)
     2              ,B4(995), B6(995), B7(995), B5(995), B11(995)
     3              , B15(995), BB7(995), BB8(995)
	CHARACTER*1  B2(995), NACH, NAMCH(29000),NMF1
	CHARACTER*3  B3(995), NAMR(29000), CDR, NMF3
	CHARACTER*50 FNAME
	CHARACTER*14 FNGFPDB1,FNGFPDB2
	CHARACTER*4  	LT(8), ENPDB, LT1, LT2
	CHARACTER*10 DN2
	CHARACTER*2  DC,DN1
	INTEGER*2    BCC(995), COD(29000), SVA(29000)
	INTEGER*4    B1(995), B8(995), NOR(29000)
	INTEGER*4    B12(995), B13(995), B14(995), B0(995)
       	DIMENSION    B9(995), DRR(995), B10(995)
	COMMON /CSCOMP/	SCOMP
	COMMON /CSPW/	SPW(400)
	COMMON /NMC/	NACH, NAMR, NAMCH
	COMMON /CXYZ/	X(29000),Y(29000),Z(29000)
	COMMON /CNCOFACT/ NCOFACT 
	COMMON /CUNUS/ IAPROT,IAUNUS
	COMMON /CENPDB/	ENPDB
	COMMON /CNMF3/	NMF3
	COMMON /CNMF1/	NMF1
	COMMON /CNRF/	NRF
	COMMON /CMCD/	CDR
	COMMON /B3C/	B3
	COMMON /COMCC/	CMET, CA1, CA2, CA3
	COMMON /B9C/	B9, B10
	COMMON /CSLI/	SLI
	COMMON /DRRC/	DRR
	COMMON /B1C/	B2, B4, B5, B6, B7, B11, B15, BB7, BB8
	COMMON /BIC/	B1, B8
	COMMON /BCBC/	BCC
	COMMON /NOC/	NOR1, NOR
	COMMON /CNN1/	NA
	COMMON /CNN2/	N11, N22
	COMMON /CCCOD/	COD
	COMMON /CIJR/	IJR
	COMMON /CRA/	RA(13), SN, ZN, SZP, SAP
	COMMON /CIFP/	IFP
	COMMON /SVC/	SVA
	COMMON /CSUFT/	SUFT(10,10)
	COMMON /CSUPR/	SUPR(10)
	COMMON /CB14/	B12, B13, B14, B0
	COMMON /CISU/	ISU
	COMMON /NABEC/	NAB(4000),NAE(4000),NRINSQ(4000)
	DATA LT /' I  ',' II ',' III',' IV ','  V ',' VI '
     2,' VII','VIII'/
	II=0
	N11=KT1
	N22=KT2
	ISU=0
	DO 106 IA=N11,N22
	II=II+1
	CALL SURFA(IA,NA,SRF)
	SPW (II)=SRF
	CALL SSCONT(IA,ISU, IACON,II)
	IIT=SVA(IA)
	DO 105 J=1,10
	SUFT(IIT,J)=SUFT(IIT,J)+SUPR(J)
	IF (IIT.NE.J) SUFT(J,IIT)=SUFT(J,IIT)+SUPR(J)
  105	CONTINUE
  106   CONTINUE
	SLI=0.0
	IF (IAUNUS.NE.0) THEN
	PRINT 1117 
 1117	FORMAT (
     k'Some ATOMs are from nucleic '/
     k,'acids or have "unusual" 3-letter residue code. The '/
     k,'analysis does not take into account these atoms.)')
	END IF
	PRINT 1096
 1096	FORMAT ('Table I')
	IF (NAMCH(KT1).EQ.' ')
     k PRINT 1007, NAMR(KT1),NOR(KT1)
	IF (NAMCH(KT1).NE.' ')
     k PRINT 2007, NAMR(KT1),NOR(KT1),NAMCH(KT1)
 2007 FORMAT ('Solvent accessible surface ',
     k'(A**2) for '/
     k,A3,I4,' (chain ',A1,')')
 1007 FORMAT ('Solvent accessible surface ',
     k'(A**2) for '
     k,A3,I4)
	PRINT 1678
 1678	FORMAT (3X,'---------------------------------')
	PRINT 1006
	PRINT 1678
 1006	FORMAT (5X,'Atom',5X,'In protein',9X,'Free')
	SLCOMP=0.0
	JKJ=1
	DO 108 I=N11,N22
	X(I)=X(I)+1000.0
  108	CONTINUE
	SRFS=0.0
	DO 107 I=N11,N22
	SLCOMP=SLCOMP+SPW(JKJ)
	CALL SURFA(I,NA,SRF)
	SLI=SLI+SRF
	SRFS=SRFS+SRF
	PRINT 3014, CMET(I),CA1(I),CA2(I),CA3(I)
     k ,spw(jkj),srf
 3014   FORMAT 
     k(5X,4A1,f11.1,3X,f10.1)
	JKJ=JKJ+1
  107   CONTINUE
	IMM=SLCOMP
	JMM=SRFS
	PRINT 7474, slcomp,srfs
 7474   FORMAT
     k(3X,'TOTAL',1X,f11.1,3X,f10.1)
	PRINT 1678
	J=N11
	JKJ=1
	SFULL=0.0
	SFOB=0.0
	SBB=0.0
	SFIL=0.0
	SAROM=0.0
	DO 100 I=N11,N22
	SJ=SPW(JKJ)
	SFULL=SFULL+SJ
	IF (JKJ.LE.4) SBB=SBB+SJ
	JJ=SVA(I)
	IF (JJ.EQ.5) SAROM=SAROM+SJ
	IF (JJ.LE.3) SFIL=SFIL+SJ
	IF (JJ.EQ.4) SFOB=SFOB+SJ
	JKJ=JKJ+1
  100   CONTINUE
	CALL SCWRH(ISU,KT1)
	SCOMP=0.0
	DO 308 I=1,ISU
	TT=B9(I)
	B9(I)=SQRT(TT)
  308	CONTINUE
	PRINT 1025
 1025 FORMAT (/'Table III')
	IF (NAMCH(KT1).EQ.' ')
     k PRINT 1009, NAMR(KT1),NOR(KT1)
	IF (NAMCH(KT1).NE.' ')
     k PRINT 2009, NAMR(KT1),NOR(KT1),NAMCH(KT1)
 1009	FORMAT ('List of putative hydrogen bonds formed'
     k,' by ',A3,I4)
 2009	FORMAT ('List of putative hydrogen bonds formed'
     k,' by ',A3,I4,' (chain ',A1,')')
	PRINT 3113
 3113	FORMAT ('----------------------------------------'
     K,'-------------------------')
	INORK=NOR(KT1)
	IF (INORK.LT.10) THEN
	PRINT 3005, NAMR(KT1),NOR(KT1)
 3005	FORMAT ('Atom from ',A3,I2,10X,'Contacting atom')
	GOTO 407
	END IF
	IF (INORK.LT.100) THEN
	PRINT 4005, NAMR(KT1),NOR(KT1)
 4005	FORMAT ('Atom from ',A3,I3,9X,'Contacting atom')
	GOTO 407
	END IF
	PRINT 4006, NAMR(KT1),NOR(KT1)
 4006	FORMAT ('Atom from ',A3,I4,8X,'Contacting atom')
  407	PRINT 3105
 3105 FORMAT ('-----------------   -------------------------'
     K,'     Dist     Surf')
	PRINT 3023
 3023 FORMAT (1x,'Name   Class       Residue     Name'
     k,'   Class')
	PRINT 3113
	DO 307 I=1,ISU
	IF (B0(I).EQ.0) GOTO 307
	I1=B12(I)
	LT1=LT(I1)
	I1=B13(I)
	LT2=LT(I1)
       PRINT 3010, BB7(I),B6(I),B7(I),B15(I),LT1,B3(I)
     k ,B1(I),B2(I),BB8(I),B4(I),B5(I),B11(I),LT2,B9(I),B10(I)
 3010 FORMAT 
     k(1x,4A1,3x,A4,8x,A3,1x,I4,A1,4x,4A1,
     k3x,A4,1X,F9.1,f9.1)
  307	CONTINUE
	PRINT 3113
	PRINT 1027
 1027	FORMAT(/'Table IV')
	IF (NAMCH(KT1).EQ.' ')
     k PRINT 1013, NAMR(KT1),NOR(KT1)
	IF (NAMCH(KT1).NE.' ')
     k PRINT 2013, NAMR(KT1),NOR(KT1),NAMCH(KT1)
 1013 FORMAT
     k('Full list of atomic contacts formed by ',A3,I4)
 2013 FORMAT
     k('Full list of atomic contacts formed by ',A3,I4
     k,' (chain ',A1,')')
	PRINT 1002, ISU
 1002 FORMAT('Total number of contacts is ',I3)
	PRINT 3113
	IF (INORK.LT.10) THEN
	PRINT 3005, NAMR(KT1),NOR(KT1)
	GOTO 408
	END IF
	IF (INORK.LT.100) THEN
	PRINT 4005, NAMR(KT1),NOR(KT1)
	GOTO 408
	END IF
	PRINT 4006, NAMR(KT1),NOR(KT1)
  408 PRINT 3105
	PRINT 3023
	PRINT 3113
	DO 304 I=1,ISU
	DC='  '
	K=-B14(I)
	I1=B12(I)
	LT1=LT(I1)
	I1=B13(I)
	LT2=LT(I1)
	IF(K.LT.0) GOTO 63
      PRINT 4026, BB7(I),B6(I),B7(I),B15(I),LT1,B3(I)
     k,B1(I),B2(I),BB8(I),B4(I),B5(I),B11(I),LT2,B9(I)
     K,B10(I),DC
 4026 FORMAT 
     k(1X,4A1,3X,A4,7X,A3,1X,I4,A1,4X,4A1,
     k3X,A4,1X,F9.1,F10.1,A2)
	GOTO 64
   63	DC="* "
      PRINT 2026, BB7(I),B6(I),B7(I),B15(I),LT1,B3(I)
     k,B1(I),B2(I),BB8(I),B4(I),B5(I),B11(I),LT2,B9(I)
     k,B10(I),DC
 2026 FORMAT 
     k(1X,4A1,3X,A4,7X,A3,1X,I4,A1,4X,4A1,
     k3X,A4,1X,F9.1,f10.1,A2)
   64	SCOMP=SCOMP+K*B10(I)
  304   CONTINUE
	PRINT 3113
  400	CONTINUE
	RETURN
	END 
	SUBROUTINE    SCWRH(ISU,KT1)
	CHARACTER*1   B4(995), B6(995), B7(995), B5(995), B11(995)
     2               ,B15(995), ABC(4), BB7(995), BB8(995)
	CHARACTER*1   NCH(100), B2(995), NCH1, NMF1, DDD(100), UU
     K,NAMCH(29000),NACH
	CHARACTER*3   NMR(100), B3(995), NMR1,NMF3,NAM3(20),TN
     K,NAMR(29000)
	CHARACTER*4  ENPDB
	INTEGER*4     NR(100),B1(995),B8(995),KP(100),NOR(29000)
	DIMENSION     RM(100), SFULL(100), B9(995), B10(995),
     2	SHB(100), SAROM(100), SFOB(100), SUNFAV(100)
	INTEGER*4    B12(995), B13(995), B14(995), B0(995)
	COMMON /NOC/	NOR1,NOR
	COMMON /NMC/	NACH,NAMR,NAMCH
	COMMON /CNAM/ 	NAM3
	COMMON /B9C/	B9, B10
	COMMON /CNMF3/	NMF3
	COMMON /CNMF1/	NMF1
	COMMON /CNRF/	NRF
	COMMON /CENPDB/	ENPDB
	COMMON /B1C/	B2, B4, B5, B6, B7, B11, B15, BB7, BB8
	COMMON /BIC/	B1, B8
	COMMON /B3C/	B3
	COMMON /CB14/	B12, B13, B14, B0
	DO 102 I=1,100
	KP(I)=0
	DDD(I)=' '
	SFULL(I)=0.0
	SHB(I)=0.0
	SAROM(I)=0.0
	SFOB(I)=0.0
	SUNFAV(I)=0.0
  102	CONTINUE
	K1=0
	DO 100 II=1,ISU
	NR1=B1(II)
	NCH1=B2(II)
	N1=B12(II)
	N2=B13(II)
	TN=B3(II)
	SS=B10(II)
	IF (K1.EQ.0) GOTO 3
	DO 101 I=1,K1
	IF (NR1.NE.NR(I).OR.NCH1.NE.NCH(I)) GOTO 101
	IF (DDD(I).EQ.'*'.OR.KP(I).EQ.0) GOTO 4
	IF (B5(II).NE.' ') DDD(I)='*'
    4	SFULL(I)=SFULL(I)+SS
	IF (RM(I).GT.B9(II)) RM(I)=B9(II)
	IF (N1.EQ.5.AND.N2.EQ.5) SAROM(I)=SAROM(I)+SS
	IF (N1.EQ.4.AND.(N2.EQ.4.OR.N2.EQ.5)) SFOB(I)=SFOB(I)+SS
	IF (N2.EQ.4.AND.N1.EQ.5) SFOB(I)=SFOB(I)+SS
	IF (B14(II).GT.0) SUNFAV(I)=SUNFAV(I)+SS
	IF (N1.GT.3.OR.N2.GT.3) GOTO 100
	IF (N1.GT.1.AND.N1.EQ.N2) GOTO 100
	SHB(I)=SHB(I)+SS
	GO TO 100
  101	CONTINUE
    3	K1=K1+1
	DO 106 KJU=1,20
	IF (TN.EQ.NAM3(KJU)) GOTO 6
  106	CONTINUE
	GOTO 7
    6	KP(K1)=1
	IF (B5(II).NE.' ') DDD(K1)='*'
    7	NR(K1)=NR1
	NCH(K1)=NCH1
	NMR(K1)=B3(II)
	RM(K1)=B9(II)
	SFULL(K1)=SS
	IF (N1.EQ.5.AND.N2.EQ.5) SAROM(K1)=SS
	IF (N1.EQ.4.AND.(N2.EQ.4.OR.N2.EQ.5)) SFOB(K1)=SS
	IF (N2.EQ.4.AND.N1.EQ.5) SFOB(K1)=SS
	IF (B14(II).GT.0) SUNFAV(K1)=SS
	IF (N1.GT.3.OR.N2.GT.3) GOTO 100
	IF (N1.GT.1.AND.N1.EQ.N2) GOTO 100
	SHB(K1)=SS
  100	CONTINUE
	KK1=K1-1
	DO 105 I=1,KK1
	KK2=I+1
	NR1=NR(I)
	NCH1=NCH(I)
	DO 105 J=KK2,K1
	IF (NCH1.GT.NCH(J)) GOTO 1
	IF (NCH1.NE.NCH(J)) GOTO 105
	IF (NR(J).GE.NR1) GOTO 105
    1	NR(I)=NR(J)
	NR(J)=NR1
	NR1=NR(I)
	UU=DDD(I)
	DDD(I)=DDD(J)
	DDD(J)=UU
	NCH(I)=NCH(J)
	NCH(J)=NCH1
	NCH1=NCH(I)
	NMR1=NMR(I)
	NMR(I)=NMR(J)
	NMR(J)=NMR1
	R=RM(I)
	RM(I)=RM(J)
	RM(J)=R
	R=SFULL(I)
	SFULL(I)=SFULL(J)
	SFULL(J)=R
	R=SHB(I)
	SHB(I)=SHB(J)
	SHB(J)=R
	R=SAROM(I)
	SAROM(I)=SAROM(J)
	SAROM(J)=R
	R=SFOB(I)
	SFOB(I)=SFOB(J)
	SFOB(J)=R
	R=SUNFAV(I)
	SUNFAV(I)=SUNFAV(J)
	SUNFAV(J)=R
  105	CONTINUE
	NCH1='KK'
	NMR1=' '
	PRINT 1055
 1055	FORMAT (/'Table II')
	IF (NAMCH(KT1).EQ.' ')
     k PRINT 1004, NAMR(KT1),NOR(KT1)
	IF (NAMCH(KT1).NE.' ')
     k PRINT 2004, NAMR(KT1),NOR(KT1),NAMCH(KT1)
 1004 FORMAT('Residues in contact with ',A3,I4)
 2004 FORMAT('Residues in contact with ',A3,I4
     k,' (chain ',A1,')')
	PRINT 3113
 3113	FORMAT ('----------------------------------------'
     K,'------------------')
	PRINT 3005
 3005 FORMAT(34X,'Specific contacts',/,31x,
     k'---------------------------')
	PRINT 3006
 3006 FORMAT(5x,'Residue      Dist    Surf    HB    Arom'
     k,'    Phob    DC')
	PRINT 3113
	DO 104 I=1,K1
	IF (NCH1.EQ.NCH(I)) GOTO 2
	NCH1=NCH(I)
    2	T=RM(I)
	T=SQRT(T)
	DO 103 II=1,4
  103	ABC(II)='-'
	IF (SHB(I).GT.0.01) ABC(1)='+'
	IF (SAROM(I).GT.0.01) ABC(2)='+'
	IF (SFOB(I).GT.0.01) ABC(3)='+'
	IF (SUNFAV(I).GT.0.01) ABC(4)='+'
	PRINT 3002, NR(I),NCH(I),NMR(I),DDD(I),T
     2	,SFULL(I),(ABC(II),II=1,4)
  104	CONTINUE
 3002	FORMAT (3x,I4,A1,2x,A3,A1,F8.1,f8.1,4x,A1
     k,6x,A1,7x,A1,6x,A1)
	PRINT 3113
	RETURN
	END



